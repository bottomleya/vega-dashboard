<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:300,400,500">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/jquery.dataTables.min.css">
        <link rel="stylesheet" href="css/jquery-confirm.min.css">
        <link rel="stylesheet" href="css/jquery-ui.css">

        <script src="js/jquery-3.5.1.js"></script>
        <script src="js/jquery.dataTables.min.js"></script>
        <script src="js/jquery-confirm.min.js"></script>
        <script src="js/dom-checkbox.js"></script>
        <script src="js/jquery-sortSections.js"></script>
        <script src="js/muuri.min.js"></script>
        <script src="js/web-animations.min.js"></script>
        <script src="js/Chart.min.js"></script>
        <script src="js/fontawesome.min.js"></script>
        <script src="js/makeResizableDiv.js"></script>
        <script src="js/jquery-ui.js"></script>
        <script src="js/vega.min.js"></script>
        <script src="js/jquery.ui.resizable.snap.ext.js"></script>
        
        <script src="js/PieChart.js"></script>
        <script src="js/Point.js"></script>

        <title>Grid Dashboard</title>
        
    </head>

    <body>
        
        <div class="sidenav" id="sidenav">
          <button title="Add new widget" class="action_button active" id="add_widget"><i class="fa fa-line-chart"></i></button>
        </div>
        
        <div class="header">
            <a class="honeywell"> Honeywell | Operational Analytics</a> <a class="text">  </a>
        </div>
            
        
         <div id="header">
            <input id="header_input" placeholder="New Dashboard">
            <div id="action_bar">
                <div id="widget_bar" class="bounding_box">
                    <div class="dropdown_button">
                        <button title="Add new widget" class="action_button" id="add_widget"><i class="fa fa-square-plus"></i></button>
                        <div class="dropdown_content">
                            <li><i class="fa fa-chart-simple"></i>&emsp;Column</li>
                            <li id="add_pie_chart_button"><i class="fa fa-chart-pie"></i>&emsp;Pie</li>
                            <li><i class="fa fa-arrow-up-right-dots"></i>&emsp;Scatter</li>
                        </div>
                    </div>
                    <button title="Enable Select-Edit" class="action_button" id="enable_select-edit"><i class="fa fa-pen-to-square"></i></button>
                </div>
                <div id="dashboard_bar" class="bounding_box">
                    <button title="Create New Dashboard" class="action_button" id="new_dashboard"><i class="fa fa-arrow-up-right-from-square"></i></button>
                    <button title="Save Dashboard" class="action_button" id="save_dashboard"><i class="fa fa-floppy-disk"></i></button>
                    <button title="Delete Dashboard" class="action_button" id="delete_dashboard"><i class="fa fa-trash"></i></button>
                    <button title="Dashboard Menu" class="action_button" id="dashboard_menu"><i class="fa fa-bars"></i></button>
                </div>
            </div>
        </div>
        
    <div id="grid" class="grid">
        <div id="donut-chart" class="item"></div>
    </div>
    
        
        
<script>
    
var spec = {
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "A basic donut chart example.",

  "data": [
    {
      "name": "table",
      "values": [
        {"id": 1, "field": 4},
        {"id": 2, "field": 6},
        {"id": 3, "field": 10},
        {"id": 4, "field": 3},
        {"id": 5, "field": 7},
        {"id": 6, "field": 8}
      ],
      "transform": [
        {
          "type": "pie",
          "field": "field",
          "startAngle": {"signal": "startAngle"},
          "endAngle": {"signal": "endAngle"},
          "sort": {"signal": "sort"}
        }
      ]
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "ordinal",
      "domain": {"data": "table", "field": "id"},
      "range": {"scheme": "category20"}
    }
  ],

  "marks": [
    {
      "type": "arc",
      "from": {"data": "table"},
      "encode": {
        "enter": {
          "fill": {"scale": "color", "field": "id"},
          "x": {"signal": "width / 2"},
          "y": {"signal": "height / 2"}
        }
      }
    }
  ]
}
;


var view = new vega.View(vega.parse(spec), {
  loader: vega.loader({baseURL: '/vega/'}),
  logLevel: vega.Warn,
  renderer: 'svg'
}).initialize('#donut-chart').hover().run();

document.querySelector('#donut-chart-svg').addEventListener('click', image(view, 'svg'));

    // create new grid layout
    var grid = new Muuri('.grid', {
        dragEnabled: true,
          dragStartPredicate: function (item, e) {
            grid.refreshItems();
            grid.layout();
            if (e.type != "move" && e.target.classList.contains("chartjs-render-monitor")) {
              return true;
            }
            // save sort order
              saveOrder();
          },
    });
        
   
    
function enableResizers() {
    $('.resizers').unbind("mouseenter mouseleave");
    $('.resizers').hover(function() {
        $(this).toggleClass('inactive');
        $(this).find('.resizer').toggleClass('hidden');
        //$(this).find('.x').toggleClass('hidden');
    });
}

enableResizers();
    
    
Chart.defaults.global.defaultFontColor = "#fff";


(function ($) {
    $(document).ready(function () {
        $('.box').draggable({snap:true}).resizable({
          snap: true,
          handles: 'all'
        });
    });
})(jQuery);

    
itemList = [];
    
selectedWidget_id = "";
tempItem = null;
 
function getSelectedItem() {
    let selectedItem = null;
    for (let i=0; i<itemList.length; i++) {
        if (itemList[i].item_id == selectedWidget_id) {
            selectedItem = itemList[i];
        }
    }
    return selectedItem;
}
    

function saveOrder() {
    for (let i=0; i<itemList.length; i++) {
        itemList[i].saveOrder();
    }
}
    
$('.close_button').click(function() {
    resetLayout();
})
    
$('#add_pie_chart_button').click(function() {
    let newChart = new PieChart("id" + (new Date()).getTime())
    itemList.push(newChart);
    selectedWidget_id = newChart.item_id;
})
    
$('.x').click(function() {
    $(this).closest('div[class=item]').remove();
})
    
</script>
      
</body>
</html>
